#!/usr/bin/env bash
DUMMY_APP_PATH=${DUMMY_APP_PATH:=/tmp/launch_base/dummy_app} && \
bundle exec rubocop -c templates/.rubocop.yml test/linters/ruby.rb && \
bundle exec reek -c templates/config.reek test/linters/ruby.rb && \
(rm -rf $DUMMY_APP_PATH || true) && \
cd .. && \
rails new $DUMMY_APP_PATH -m launch-base/templates/launch_base_default_template.rb && \
cd - && \
DUMMY_APP_PATH=$DUMMY_APP_PATH bundle exec rake test && bundle exec codeclimate-test-reporter && \
cd $DUMMY_APP_PATH && \
export BUNDLE_GEMFILE=./Gemfile && \
echo $BUNDLE_GEMFILE && \
bundle install && \
bundle exec rspec spec && \
docker build . -f dockerfiles/ci/Dockerfile
